<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipment #{{.Shipment.ID}} - Laptop Tracking System</title>
    <link rel="stylesheet" href="/static/css/output.css" />
</head>
<body class="bg-gray-50 min-h-screen">
    {{template "navbar.html" .}}

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Back Button -->
        <div class="mb-4">
            <a href="/shipments" class="text-sm text-blue-600 hover:text-blue-800">
                ‚Üê Back to Shipments
            </a>
        </div>

        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center gap-4 mb-2">
                <h2 class="text-3xl font-bold text-gray-900">Shipment #{{.Shipment.ID}}</h2>
                {{if eq .Shipment.ShipmentType "single_full_journey"}}
                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-blue-100 text-blue-800 border-2 border-blue-500">
                    <svg class="mr-2 h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                    </svg>
                    Single Full Journey
                </span>
                {{else if eq .Shipment.ShipmentType "bulk_to_warehouse"}}
                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-purple-100 text-purple-800 border-2 border-purple-500">
                    <svg class="mr-2 h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 4.5A2.5 2.5 0 014.5 2h11A2.5 2.5 0 0118 4.5v11a2.5 2.5 0 01-2.5 2.5h-11A2.5 2.5 0 012 15.5v-11zM4.5 4a.5.5 0 00-.5.5v11a.5.5 0 00.5.5h11a.5.5 0 00.5-.5v-11a.5.5 0 00-.5-.5h-11z"/>
                    </svg>
                    Bulk to Warehouse ({{.Shipment.LaptopCount}} laptops)
                </span>
                {{else if eq .Shipment.ShipmentType "warehouse_to_engineer"}}
                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800 border-2 border-green-500">
                    <svg class="mr-2 h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    Warehouse ‚Üí Engineer
                </span>
                {{else}}
                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-800 border-2 border-gray-500">
                    {{.Shipment.ShipmentType}}
                </span>
                {{end}}
            </div>
            <p class="mt-2 text-gray-600">
                {{if eq .Shipment.ShipmentType "single_full_journey"}}
                Complete journey from client to warehouse to engineer
                {{else if eq .Shipment.ShipmentType "bulk_to_warehouse"}}
                Bulk shipment to warehouse (laptops registered during reception)
                {{else if eq .Shipment.ShipmentType "warehouse_to_engineer"}}
                Direct shipment from warehouse inventory to engineer
                {{else}}
                Complete shipment details and tracking history
                {{end}}
            </p>
        </div>

        <!-- Error/Success/Warning Messages -->
        {{if .Error}}
        <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <p class="text-sm text-red-800">{{.Error}}</p>
        </div>
        {{end}}

        {{if .Success}}
        <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <p class="text-sm text-green-800">{{.Success}}</p>
        </div>
        {{end}}

        {{if .Warning}}
        <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <p class="text-sm text-yellow-800">‚ö†Ô∏è {{.Warning}}</p>
        </div>
        {{end}}

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Shipment Information -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Shipment Information</h3>
                    <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Shipment Type</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {{if eq .Shipment.ShipmentType "single_full_journey"}}
                                Single Full Journey
                                {{else if eq .Shipment.ShipmentType "bulk_to_warehouse"}}
                                Bulk to Warehouse
                                {{else if eq .Shipment.ShipmentType "warehouse_to_engineer"}}
                                Warehouse ‚Üí Engineer
                                {{else}}
                                {{.Shipment.ShipmentType}}
                                {{end}}
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Laptop Count</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {{.Shipment.LaptopCount}}
                                {{if eq .Shipment.LaptopCount 1}}laptop{{else}}laptops{{end}}
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Status</dt>
                            <dd class="mt-1">
                                <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full 
                                    {{if eq .Shipment.Status "delivered"}}bg-green-100 text-green-800
                                    {{else if eq .Shipment.Status "at_warehouse"}}bg-blue-100 text-blue-800
                                    {{else if eq .Shipment.Status "pending_pickup_from_client"}}bg-yellow-100 text-yellow-800
                                    {{else}}bg-gray-100 text-gray-800{{end}}">
                                    {{.Shipment.Status | printf "%s" | replace "_" " " | title}}
                                </span>
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">JIRA Ticket</dt>
                            <dd class="mt-1 text-sm text-gray-900 font-mono">
                                {{if .Shipment.JiraTicketNumber}}
                                <a href="https://bairesdev.atlassian.net/browse/{{.Shipment.JiraTicketNumber}}" 
                                   target="_blank" 
                                   class="text-blue-600 hover:text-blue-800">
                                    {{.Shipment.JiraTicketNumber}} ‚Üó
                                </a>
                                {{else}}
                                <span class="text-gray-400">Not specified</span>
                                {{end}}
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Client Company</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{.CompanyName}}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Software Engineer</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {{if .EngineerName}}
                                {{.EngineerName}}
                                {{else}}
                                <span class="text-gray-400">Not assigned</span>
                                {{end}}
                            </dd>
                        </div>
                        {{if .Shipment.CourierName}}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Courier</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{.Shipment.CourierName}}</dd>
                        </div>
                        {{end}}
                        {{if .Shipment.TrackingNumber}}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Tracking Number</dt>
                            <dd class="mt-1 text-sm text-gray-900 font-mono">
                                {{if ne .TrackingURL ""}}
                                <a href="{{.TrackingURL}}" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   class="text-blue-600 hover:text-blue-800 hover:underline">
                                    {{.Shipment.TrackingNumber}} ‚Üó
                                </a>
                                {{else}}
                                {{.Shipment.TrackingNumber}}
                                {{end}}
                            </dd>
                        </div>
                        {{end}}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Created</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{.Shipment.CreatedAt.Format "Jan 02, 2006 15:04"}}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Updated</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{.Shipment.UpdatedAt.Format "Jan 02, 2006 15:04"}}</dd>
                        </div>
                    </dl>

                    {{if .PickupFormData}}
                    <!-- Pickup Form Details -->
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="text-base font-semibold text-gray-900 mb-4">Pickup Form Details</h4>
                        
                        <!-- Contact Information -->
                        {{if or (index .PickupFormData "contact_name") (index .PickupFormData "contact_email") (index .PickupFormData "contact_phone")}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Contact Information</h5>
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {{if index .PickupFormData "contact_name"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Contact Name</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "contact_name"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "contact_email"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Contact Email</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "contact_email"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "contact_phone"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Contact Phone</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "contact_phone"}}</dd>
                                </div>
                                {{end}}
                            </dl>
                        </div>
                        {{end}}

                        <!-- Pickup Address -->
                        {{if or (index .PickupFormData "pickup_address") (index .PickupFormData "pickup_city") (index .PickupFormData "pickup_state") (index .PickupFormData "pickup_zip")}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Pickup Address</h5>
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {{if index .PickupFormData "pickup_address"}}
                                <div class="md:col-span-2">
                                    <dt class="text-sm font-medium text-gray-500">Street Address</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "pickup_address"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "pickup_city"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">City</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "pickup_city"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "pickup_state"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">State</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "pickup_state"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "pickup_zip"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">ZIP Code</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "pickup_zip"}}</dd>
                                </div>
                                {{end}}
                            </dl>
                        </div>
                        {{end}}

                        <!-- Pickup Schedule -->
                        {{if or (index .PickupFormData "pickup_date") (index .PickupFormData "pickup_time_slot")}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Pickup Schedule</h5>
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {{if index .PickupFormData "pickup_date"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Pickup Date</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "pickup_date"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "pickup_time_slot"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Time Slot</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "pickup_time_slot" | title}}</dd>
                                </div>
                                {{end}}
                            </dl>
                        </div>
                        {{end}}

                        <!-- Shipment Details -->
                        {{if or (index .PickupFormData "number_of_laptops") (index .PickupFormData "number_of_boxes") (index .PickupFormData "assignment_type")}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Shipment Details</h5>
                            <dl class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {{if index .PickupFormData "number_of_laptops"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Number of Laptops</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "number_of_laptops"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "number_of_boxes"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Number of Boxes</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "number_of_boxes"}}</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "assignment_type"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Assignment Type</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "assignment_type" | title}}</dd>
                                </div>
                                {{end}}
                            </dl>
                        </div>
                        {{end}}

                        <!-- Bulk Dimensions (if bulk assignment) -->
                        {{if eq (index .PickupFormData "assignment_type") "bulk"}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Bulk Shipment Dimensions</h5>
                            <dl class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                {{if index .PickupFormData "bulk_length"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Length</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "bulk_length"}} in</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "bulk_width"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Width</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "bulk_width"}} in</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "bulk_height"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Height</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "bulk_height"}} in</dd>
                                </div>
                                {{end}}
                                {{if index .PickupFormData "bulk_weight"}}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Weight</dt>
                                    <dd class="mt-1 text-sm text-gray-900">{{index .PickupFormData "bulk_weight"}} lbs</dd>
                                </div>
                                {{end}}
                            </dl>
                        </div>
                        {{end}}

                        <!-- Accessories -->
                        {{if index .PickupFormData "include_accessories"}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Accessories</h5>
                            {{if index .PickupFormData "accessories_description"}}
                            <p class="text-sm text-gray-900">{{index .PickupFormData "accessories_description"}}</p>
                            {{else}}
                            <p class="text-sm text-gray-500 italic">Accessories included (no description provided)</p>
                            {{end}}
                        </div>
                        {{end}}

                        <!-- Special Instructions -->
                        {{if index .PickupFormData "special_instructions"}}
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold text-gray-700 mb-3">Special Instructions</h5>
                            <p class="text-sm text-gray-900">{{index .PickupFormData "special_instructions"}}</p>
                        </div>
                        {{end}}
                    </div>
                    {{end}}

                    {{if .Shipment.Notes}}
                    <div class="mt-4 pt-4 border-t">
                        <dt class="text-sm font-medium text-gray-500 mb-2">Notes</dt>
                        <dd class="text-sm text-gray-700">{{.Shipment.Notes}}</dd>
                    </div>
                    {{end}}
                </div>

                <!-- Timeline -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Tracking Timeline</h3>
                    <div class="flow-root">
                        <ul class="-mb-8">
                            {{range $index, $item := .Timeline}}
                            <li>
                                <div class="relative {{if ne $index (len $.Timeline | add -1)}}pb-8{{end}}">
                                    {{if ne $index (len $.Timeline | add -1)}}
                                    <span class="absolute top-8 left-4 -ml-px h-full w-0.5 {{if $item.IsCompleted}}bg-green-500{{else}}bg-gray-200{{end}}" aria-hidden="true"></span>
                                    {{end}}
                                    <div class="relative flex space-x-3">
                                        <div>
                                            {{if $item.IsCompleted}}
                                            <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white">
                                                <svg class="h-5 w-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                                </svg>
                                            </span>
                                            {{else if $item.IsCurrent}}
                                                {{if $item.IsTransit}}
                                                <span class="h-8 w-8 rounded-full bg-orange-500 flex items-center justify-center ring-8 ring-white">
                                                    <svg class="h-5 w-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                                                        <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
                                                    </svg>
                                                </span>
                                                {{else}}
                                                <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                                                    <svg class="h-5 w-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                                    </svg>
                                                </span>
                                                {{end}}
                                            {{else}}
                                            <span class="h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center ring-8 ring-white">
                                                <svg class="h-5 w-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
                                                </svg>
                                            </span>
                                            {{end}}
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm font-medium {{if $item.IsCompleted}}text-gray-900{{else if $item.IsCurrent}}text-blue-900 font-semibold{{else}}text-gray-500{{end}}">
                                                    {{$item.Label}}
                                                    {{if $item.IsCurrent}}<span class="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">Current</span>{{end}}
                                                </p>
                                                {{if and (eq $item.Status "in_transit_to_engineer") $.Shipment.ETAToEngineer}}
                                                <p class="text-xs text-gray-600 mt-1">
                                                    <span class="font-medium">ETA:</span> {{$.Shipment.ETAToEngineer.Format "Jan 02, 2006 15:04"}}
                                                </p>
                                                {{end}}
                                                {{if $item.TrackingNumber}}
                                                <p class="text-xs text-gray-600 mt-1">
                                                    <span class="font-medium">Tracking:</span> 
                                                    {{if ne $.TrackingURL ""}}
                                                    <a href="{{$.TrackingURL}}" 
                                                       target="_blank" 
                                                       rel="noopener noreferrer"
                                                       class="font-mono text-blue-600 hover:text-blue-800 hover:underline">
                                                        {{$item.TrackingNumber}} ‚Üó
                                                    </a>
                                                    {{else}}
                                                    <span class="font-mono">{{$item.TrackingNumber}}</span>
                                                    {{end}}
                                                </p>
                                                {{end}}
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap {{if $item.IsCompleted}}text-gray-500{{else}}text-gray-400{{end}}">
                                                {{if $item.Timestamp}}
                                                    {{if eq $item.Status "pending_pickup_from_client"}}
                                                        {{$item.Timestamp.Format "Jan 02, 2006"}}
                                                    {{else}}
                                                        {{$item.Timestamp.Format "Jan 02, 2006 15:04"}}
                                                    {{end}}
                                                {{else if $item.IsCurrent}}
                                                    In Progress
                                                {{else}}
                                                    Pending
                                                {{end}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            {{end}}
                        </ul>
                    </div>
                </div>

                <!-- Laptops -->
                {{if .Laptops}}
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Laptops in Shipment</h3>
                    <div class="space-y-3">
                        {{range .Laptops}}
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-medium text-gray-900">{{.Brand}} {{.Model}}</p>
                                    <p class="text-sm text-gray-500 font-mono">SN: {{.SerialNumber}}</p>
                                    {{if .Specs}}
                                    <p class="text-sm text-gray-600 mt-1">{{.Specs}}</p>
                                    {{end}}
                                </div>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                    {{laptopStatusDisplayName .Status}}
                                </span>
                            </div>
                        </div>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        {{if eq .User.Role "logistics"}}
                        <!-- Status Update Form -->
                        <form action="/shipments/{{.Shipment.ID}}/status" method="POST" class="space-y-3" id="statusUpdateForm">
                            <div>
                                <label for="status" class="block text-sm font-medium text-gray-700 mb-2">
                                    Update Status
                                </label>
                                <select 
                                    id="status" 
                                    name="status" 
                                    required
                                    onchange="toggleETAField()"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                >
                                    <option value="">Select new status...</option>
                                    {{if .NextAllowedStatuses}}
                                        {{range .NextAllowedStatuses}}
                                            {{if eq . "pending_pickup_from_client"}}
                                            <option value="pending_pickup_from_client">Pending Pickup from Client</option>
                                            {{else if eq . "pickup_from_client_scheduled"}}
                                            <option value="pickup_from_client_scheduled">Pickup from Client Scheduled</option>
                                            {{else if eq . "picked_up_from_client"}}
                                            <option value="picked_up_from_client">Picked Up from Client</option>
                                            {{else if eq . "in_transit_to_warehouse"}}
                                            <option value="in_transit_to_warehouse">In Transit to Warehouse</option>
                                            {{else if eq . "at_warehouse"}}
                                            <option value="at_warehouse">At Warehouse</option>
                                            {{else if eq . "released_from_warehouse"}}
                                            <option value="released_from_warehouse">Released from Warehouse</option>
                                            {{else if eq . "in_transit_to_engineer"}}
                                            <option value="in_transit_to_engineer">In Transit to Engineer</option>
                                            {{else if eq . "delivered"}}
                                            <option value="delivered">Delivered</option>
                                            {{end}}
                                        {{end}}
                                    {{else}}
                                        <option value="" disabled>No status updates available</option>
                                    {{end}}
                                </select>
                            </div>
                            <!-- ETA Field (shown only when status is in_transit_to_engineer) -->
                            <div id="etaField" style="display: none;">
                                <label for="eta_to_engineer" class="block text-sm font-medium text-gray-700 mb-2">
                                    Estimated Time of Arrival
                                </label>
                                <input 
                                    type="datetime-local" 
                                    id="eta_to_engineer" 
                                    name="eta_to_engineer"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"
                                />
                                <p class="mt-1 text-xs text-gray-500">Estimated delivery time to the software engineer</p>
                            </div>
                            <!-- Tracking Number Field (shown only when status is pickup_from_client_scheduled) -->
                            <div id="trackingNumberField" style="display: none;">
                                <label for="tracking_number" class="block text-sm font-medium text-gray-700 mb-2">
                                    Tracking Number <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="tracking_number" 
                                    name="tracking_number"
                                    placeholder="1Z999AA10123456784"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                />
                                <p class="mt-1 text-xs text-gray-500">Enter the tracking number for the scheduled pickup</p>
                            </div>
                            <!-- Courier Field (shown only when status is pickup_from_client_scheduled) -->
                            <div id="courierField" style="display: none;">
                                <label for="courier_name" class="block text-sm font-medium text-gray-700 mb-2">
                                    Courier <span class="text-red-500">*</span>
                                </label>
                                <select 
                                    id="courier_name" 
                                    name="courier_name"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                >
                                    <option value="">Select courier...</option>
                                    <option value="UPS" selected>UPS</option>
                                    <option value="FedEx">FedEx</option>
                                    <option value="DHL">DHL</option>
                                </select>
                                <p class="mt-1 text-xs text-gray-500">Select the courier service for pickup</p>
                            </div>
                            <input type="hidden" name="shipment_id" value="{{.Shipment.ID}}">
                            <button 
                                type="submit" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition text-sm font-medium"
                            >
                                Update Status
                            </button>
                        </form>
                        
                        <script>
                        function toggleETAField() {
                            const statusSelect = document.getElementById('status');
                            const etaField = document.getElementById('etaField');
                            const etaInput = document.getElementById('eta_to_engineer');
                            const trackingNumberField = document.getElementById('trackingNumberField');
                            const trackingNumberInput = document.getElementById('tracking_number');
                            const courierField = document.getElementById('courierField');
                            const courierInput = document.getElementById('courier_name');
                            
                            // Show ETA field for in_transit_to_engineer status
                            if (statusSelect.value === 'in_transit_to_engineer') {
                                etaField.style.display = 'block';
                            } else {
                                etaField.style.display = 'none';
                                etaInput.value = ''; // Clear the value when hidden
                            }
                            
                            // Show tracking number and courier fields for pickup_from_client_scheduled status
                            if (statusSelect.value === 'pickup_from_client_scheduled') {
                                trackingNumberField.style.display = 'block';
                                trackingNumberInput.required = true;
                                courierField.style.display = 'block';
                                courierInput.required = true;
                            } else {
                                trackingNumberField.style.display = 'none';
                                trackingNumberInput.required = false;
                                trackingNumberInput.value = ''; // Clear the value when hidden
                                courierField.style.display = 'none';
                                courierInput.required = false;
                                courierInput.value = ''; // Clear the value when hidden
                            }
                        }
                        
                        // Check on page load in case status is already set
                        document.addEventListener('DOMContentLoaded', function() {
                            toggleETAField();
                        });
                        </script>

                        <!-- Assign Engineer Form -->
                        {{if and (not .Shipment.SoftwareEngineerID) .Engineers}}
                        <form action="/shipments/{{.Shipment.ID}}/assign-engineer" method="POST" class="space-y-3 pt-3 border-t">
                            <div>
                                <label for="engineer_id" class="block text-sm font-medium text-gray-700 mb-2">
                                    Assign Engineer
                                </label>
                                <select 
                                    id="engineer_id" 
                                    name="engineer_id" 
                                    required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"
                                >
                                    <option value="">Select engineer...</option>
                                    {{range .Engineers}}
                                    <option value="{{.ID}}">{{.Name}} ({{.Email}})</option>
                                    {{end}}
                                </select>
                            </div>
                            <button 
                                type="submit" 
                                class="w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition text-sm font-medium"
                            >
                                Assign Engineer
                            </button>
                        </form>
                        {{end}}

                        <!-- Send Magic Link Form (only for pending_pickup_from_client or pickup_from_client_scheduled statuses) -->
                        {{if or (eq .Shipment.Status "pending_pickup_from_client") (eq .Shipment.Status "pickup_from_client_scheduled")}}
                        <form action="/auth/send-magic-link" method="POST" class="space-y-3 pt-3 border-t">
                            <div>
                                <label for="magic_link_email" class="block text-sm font-medium text-gray-700 mb-2">
                                    Send Magic Link
                                </label>
                                <input 
                                    type="email" 
                                    id="magic_link_email" 
                                    name="email" 
                                    required
                                    placeholder="project.manager@example.com"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"
                                />
                                <p class="mt-1 text-xs text-gray-500">Send pickup form link to PM or Client</p>
                            </div>
                            <input type="hidden" name="shipment_id" value="{{.Shipment.ID}}">
                            <button 
                                type="submit" 
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition text-sm font-medium"
                            >
                                üìß Send Magic Link
                            </button>
                        </form>
                        {{end}}
                        {{end}}
                        
                        {{if and (eq .User.Role "warehouse") (eq .Shipment.Status "in_transit_to_warehouse")}}
                        <a href="/reception-report?shipment_id={{.Shipment.ID}}" 
                           class="block w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition text-sm font-medium text-center">
                            Submit Reception Report
                        </a>
                        {{end}}

                        {{if or (eq .Shipment.Status "in_transit_to_engineer") (eq .Shipment.Status "released_from_warehouse")}}
                        <a href="/delivery-form?shipment_id={{.Shipment.ID}}" 
                           class="block w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition text-sm font-medium text-center">
                            Confirm Delivery
                        </a>
                        {{end}}
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Contact Information</h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <p class="text-gray-500 mb-1">Client Company</p>
                            <p class="text-gray-900 font-medium">{{.CompanyName}}</p>
                        </div>
                        {{if .EngineerName}}
                        <div>
                            <p class="text-gray-500 mb-1">Software Engineer</p>
                            <p class="text-gray-900 font-medium">{{.EngineerName}}</p>
                            {{if .EngineerEmail}}
                            <p class="text-gray-600">{{.EngineerEmail}}</p>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>


